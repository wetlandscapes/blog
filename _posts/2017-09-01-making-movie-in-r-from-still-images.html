---
title: Making a movie in R from still images
date: '2017-09-01T12:56:00.000-07:00'
author: Jason Mercer
tags: 
modified_time: '2017-09-04T07:54:39.117-07:00'
thumbnail: https://i.ytimg.com/vi/UC9O-1OdYtg/default.jpg
blogger_id: tag:blogger.com,1999:blog-6358102967869452105.post-1743207136425542529
blogger_orig_url: https://theartoflittlequestions.blogspot.com/2017/09/making-movie-in-r-from-still-images.html
---

<html> <head><style type="text/css">.knitr .inline {   background-color: #f7f7f7;   border:solid 1px #B0B0B0; } .error {  font-weight: bold;  color: #FF0000; } .warning {  font-weight: bold; } .message {  font-style: italic; } .source, .output, .warning, .error, .message {  padding: 0 1em;   border:solid 1px #F7F7F7; } .source {   background-color: #f5f5f5; } .rimage .left {   text-align: left; } .rimage .right {   text-align: right; } .rimage .center {   text-align: center; } .hl.num {   color: #AF0F91; } .hl.str {   color: #317ECC; } .hl.com {   color: #AD95AF;   font-style: italic; } .hl.opt {   color: #000000; } .hl.std {   color: #585858; } .hl.kwa {   color: #295F94;   font-weight: bold; } .hl.kwb {   color: #B05A65; } .hl.kwc {   color: #55aa55; } .hl.kwd {   color: #BC5A65;   font-weight: bold; } </style><title>Making a movie in R from still images</title></head> <body> <p>This summer I was doing some hydrogeophysics at a mountain fen to better understand the role biogenic gasses play in determining flowpaths on those ecosystems. As part of that endeavour I setup a field camera to take a photo every hour. I then used R, ImageMagick, and FFmpeg to stitch those photos into a movie. Below is the code for the movie (without sound):</p> <div class="chunk" id="unnamed-chunk-1"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com">#Note: this script requires both ImageMagick and FFmpeg to be installed</span><br /><span class="hl com"># on your computer to work properly. (It may not even need ImageMagick, but I</span><br /><span class="hl com"># had already set that up prior, and the magick package makes calls to that program.)</span><br /><br /><span class="hl kwd">library</span><span class="hl std">(magick)</span><br /><span class="hl kwd">library</span><span class="hl std">(animation)</span><br /><br /><span class="hl com">#This tells the animation package where FFmpeg lives on my computer.</span><br /><span class="hl com">#FFmpeg is what is actually doing all the heavy lifting.</span><br /><span class="hl std">animation</span><span class="hl opt">::</span><span class="hl kwd">ani.options</span><span class="hl std">(</span><span class="hl kwc">ffmpeg</span> <span class="hl std">=</span> <span class="hl kwd">shortPathName</span><span class="hl std">(</span><span class="hl str">&quot;C:/ffmpeg/bin/ffmpeg.exe&quot;</span><span class="hl std">))</span><br /><br /><span class="hl com">#The working directory in which the photos are located. This is also where I'm</span><br /><span class="hl com"># going to create the final video.</span><br /><span class="hl kwd">setwd</span><span class="hl std">(</span><span class="hl str">&quot;C:/LargeFiles/PhD/SLF Geophysics Photos&quot;</span><span class="hl std">)</span><br /><br /><span class="hl com">#A vector containing all the photo names. All images contain the string: MDGC.</span><br /><span class="hl std">SLF.photos</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">list.files</span><span class="hl std">(</span><span class="hl kwc">pattern</span> <span class="hl std">=</span> <span class="hl str">&quot;MDGC&quot;</span><span class="hl std">,</span> <span class="hl kwc">all.files</span> <span class="hl std">=</span> <span class="hl num">TRUE</span><span class="hl std">,</span> <span class="hl kwc">ignore.case</span> <span class="hl std">=</span> <span class="hl num">TRUE</span><span class="hl std">)</span><br /><br /><span class="hl com">#This extracts the underlying height, width, and type of image.</span><br /><span class="hl std">img.height</span> <span class="hl kwb">&lt;-</span> <span class="hl std">magick</span><span class="hl opt">::</span><span class="hl kwd">image_info</span><span class="hl std">(</span><span class="hl kwd">image_read</span><span class="hl std">(SLF.photos[</span><span class="hl num">1</span><span class="hl std">]))</span><span class="hl opt">$</span><span class="hl std">height</span><br /><span class="hl std">img.width</span> <span class="hl kwb">&lt;-</span> <span class="hl std">magick</span><span class="hl opt">::</span><span class="hl kwd">image_info</span><span class="hl std">(</span><span class="hl kwd">image_read</span><span class="hl std">(SLF.photos[</span><span class="hl num">1</span><span class="hl std">]))</span><span class="hl opt">$</span><span class="hl std">width</span><br /><span class="hl std">img.type</span> <span class="hl kwb">&lt;-</span> <span class="hl std">magick</span><span class="hl opt">::</span><span class="hl kwd">image_info</span><span class="hl std">(</span><span class="hl kwd">image_read</span><span class="hl std">(SLF.photos[</span><span class="hl num">1</span><span class="hl std">]))</span><span class="hl opt">$</span><span class="hl std">format</span><br /><br /><span class="hl com">#This tells FFmpeg that each picture should be displayed for 0.25 seconds,</span><br /><span class="hl com"># the height of the image, the width of the image, and the appropriate</span><br /><span class="hl com"># image engine to use.</span><br /><span class="hl com">#Note: tolower() converts uppercase letters to lowercase letters.</span><br /><span class="hl std">animation</span><span class="hl opt">::</span><span class="hl kwd">ani.options</span><span class="hl std">(</span><span class="hl kwc">interval</span> <span class="hl std">=</span> <span class="hl num">0.25</span><span class="hl std">,</span><br />                       <span class="hl kwc">ani.height</span> <span class="hl std">= img.height,</span><br />                       <span class="hl kwc">ani.width</span> <span class="hl std">= img.width,</span><br />                       <span class="hl kwc">ani.dev</span> <span class="hl std">=</span> <span class="hl kwd">tolower</span><span class="hl std">(img.type),</span><br />                       <span class="hl kwc">ani.type</span> <span class="hl std">=</span> <span class="hl kwd">tolower</span><span class="hl std">(img.type))</span><br /><br /><span class="hl com">#By default the input dimensions of the image (designated here by img.height</span><br /><span class="hl com"># and img.width) dictate the output resolution. Below, I'm increasing the</span><br /><span class="hl com"># video dimensions to improve the image quality.</span><br /><span class="hl std">opts</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;-s &quot;</span><span class="hl std">, img.height</span> <span class="hl opt">*</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl str">&quot;x&quot;</span><span class="hl std">, img.width</span> <span class="hl opt">*</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)</span><br /><br /><span class="hl std">animation</span><span class="hl opt">::</span><span class="hl kwd">saveVideo</span><span class="hl std">(</span><br />  <span class="hl com">#Loop through all the photos, adding them one at a time. Not sure if this</span><br />  <span class="hl com"># is the most efficient way of doing things, but it works.</span><br />  <span class="hl kwa">for</span><span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(SLF.photos)){</span><br />    <span class="hl com">#Read in an image.</span><br />    <span class="hl std">SLF.image</span> <span class="hl kwb">&lt;-</span> <span class="hl std">magick</span><span class="hl opt">::</span><span class="hl kwd">image_read</span><span class="hl std">(SLF.photos[i])</span><br />    <span class="hl com">#Plot the image.</span><br />    <span class="hl kwd">plot</span><span class="hl std">(SLF.image)</span><br />  <span class="hl std">},</span><br />  <span class="hl com">#Designate the name of the image within the working directory.</span><br />  <span class="hl kwc">video.name</span> <span class="hl std">=</span> <span class="hl str">&quot;AnimationSLFGeo.avi&quot;</span><span class="hl std">,</span><br />  <span class="hl com">#The extra image quality parameters indicated earlier.</span><br />  <span class="hl kwc">other.opts</span> <span class="hl std">= opts</span><br /><span class="hl std">)</span><br /></pre></div></div></div> <p>Here is a YouTube version of the resultant video, after I added some music to it:</p> <iframe width="560" height="315" src="https://www.youtube.com/embed/UC9O-1OdYtg" frameborder="0" allowfullscreen></iframe>    </body></html>